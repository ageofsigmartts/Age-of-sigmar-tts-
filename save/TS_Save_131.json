{
  "SaveName": "battlescribe2tts",
  "GameMode": "Large Wood Table",
  "Date": "2/10/2021 6:14:40 PM",
  "VersionNumber": "v13.0.4",
  "GameType": "",
  "GameComplexity": "",
  "Tags": [],
  "Gravity": 0.5,
  "PlayArea": 0.5,
  "Table": "Table_RPG",
  "Sky": "Sky_Regal",
  "Note": "",
  "Rules": "",
  "MusicPlayer": {
    "RepeatSong": false,
    "PlaylistEntry": -1,
    "CurrentAudioTitle": "Test",
    "CurrentAudioURL": "http://cloud-3.steamusercontent.com/ugc/786380099323626571/5E0AFF72D442A53EB2DFE18145CBC8FC2A7A2017/",
    "AudioLibrary": []
  },
  "Grid": {
    "Type": 0,
    "Lines": false,
    "Color": {
      "r": 0.0,
      "g": 0.0,
      "b": 0.0
    },
    "Opacity": 0.75,
    "ThickLines": false,
    "Snapping": false,
    "Offset": false,
    "BothSnapping": false,
    "xSize": 2.25,
    "ySize": 3.29,
    "PosOffset": {
      "x": 0.0,
      "y": 1.0,
      "z": 0.0
    }
  },
  "Lighting": {
    "LightIntensity": 0.54,
    "LightColor": {
      "r": 1.0,
      "g": 0.9804,
      "b": 0.8902
    },
    "AmbientIntensity": 1.3,
    "AmbientType": 0,
    "AmbientSkyColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientEquatorColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientGroundColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "ReflectionIntensity": 1.0,
    "LutIndex": 0,
    "LutContribution": 1.0
  },
  "Hands": {
    "Enable": true,
    "DisableUnused": false,
    "Hiding": 0
  },
  "ComponentTags": {
    "labels": []
  },
  "Turns": {
    "Enable": false,
    "Type": 0,
    "TurnOrder": [],
    "Reverse": false,
    "SkipEmpty": false,
    "DisableInteractions": false,
    "PassTurns": true,
    "TurnColor": ""
  },
  "TabStates": {
    "0": {
      "title": "Rules",
      "body": "Game start:\nPick a card (that will be your adventurer) Each one has different abilities. Specialty is used at any time during your turn as the adventurer, the ultimate ability can only be used once per turn, once used you tab the card. (turn it sideways)\n\nRoll all the party dice at the beginning of your turn as the adventurer. (Guild leader gets one additional party die to roll)\n\nDungeon master rolls dungeon dice based on level (level 1=1 die, level 2=2 die, and so on) If you can't roll the amount needed for a level you just roll all the dice. (ex. level 8 you just roll all 7)\n\nAt the end of your turn as the adventurer, collect XP based on level reached, add 1 additional XP per dragon defeated on your turn. You pass the dice to the left. (Dungeon master now becomes the adventurer and next player to the left of them becomes the dungeon master)\n\nDragons: When a dragon is rolled it goes to the Dragon's Lair, when three are in the lair you must fight the dragon. You need three different classes to defeat the dragon. If defeated you collect one additional XP and a treasure.\n\nEnd game:\nAfter three dungeon delves XP is added up and the player with the most XP wins. Any treasure accumulated at the end of the game counts as one additional XP.  (Town portal counts as 2 XP and dragon scales count as 2 XP if you have a pair, otherwise they count as nothing.\n\nLearn to play in more detail here:\nhttps://www.youtube.com/watch?v=PzZ8hUzXBtE",
      "color": "Grey",
      "visibleColor": {
        "r": 0.5,
        "g": 0.5,
        "b": 0.5
      },
      "id": 0
    },
    "1": {
      "title": "White",
      "body": "",
      "color": "White",
      "visibleColor": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "id": 1
    },
    "2": {
      "title": "Brown",
      "body": "",
      "color": "Brown",
      "visibleColor": {
        "r": 0.443,
        "g": 0.231,
        "b": 0.09
      },
      "id": 2
    },
    "3": {
      "title": "Red",
      "body": "",
      "color": "Red",
      "visibleColor": {
        "r": 0.856,
        "g": 0.1,
        "b": 0.094
      },
      "id": 3
    },
    "4": {
      "title": "Orange",
      "body": "",
      "color": "Orange",
      "visibleColor": {
        "r": 0.956,
        "g": 0.392,
        "b": 0.113
      },
      "id": 4
    },
    "5": {
      "title": "Yellow",
      "body": "",
      "color": "Yellow",
      "visibleColor": {
        "r": 0.905,
        "g": 0.898,
        "b": 0.172
      },
      "id": 5
    },
    "6": {
      "title": "Green",
      "body": "",
      "color": "Green",
      "visibleColor": {
        "r": 0.192,
        "g": 0.701,
        "b": 0.168
      },
      "id": 6
    },
    "7": {
      "title": "Blue",
      "body": "",
      "color": "Blue",
      "visibleColor": {
        "r": 0.118,
        "g": 0.53,
        "b": 1.0
      },
      "id": 7
    },
    "8": {
      "title": "Teal",
      "body": "",
      "color": "Teal",
      "visibleColor": {
        "r": 0.129,
        "g": 0.694,
        "b": 0.607
      },
      "id": 8
    },
    "9": {
      "title": "Purple",
      "body": "",
      "color": "Purple",
      "visibleColor": {
        "r": 0.627,
        "g": 0.125,
        "b": 0.941
      },
      "id": 9
    },
    "10": {
      "title": "Pink",
      "body": "",
      "color": "Pink",
      "visibleColor": {
        "r": 0.96,
        "g": 0.439,
        "b": 0.807
      },
      "id": 10
    },
    "11": {
      "title": "Black",
      "body": "",
      "color": "Black",
      "visibleColor": {
        "r": 0.25,
        "g": 0.25,
        "b": 0.25
      },
      "id": 11
    }
  },
  "DecalPallet": [],
  "LuaScript": "--[[ Lua code. See documentation: https://api.tabletopsimulator.com/ --]]\n\n--[[ The onLoad event is called after the game save finishes loading. --]]\nfunction onLoad()\n    --[[ print('onLoad!') --]]\nend\n\n--[[ The onUpdate event is called once per frame. --]]\nfunction onUpdate()\n    --[[ print('onUpdate loop!') --]]\nend",
  "LuaScriptState": "",
  "XmlUI": "<!-- Xml UI. See documentation: https://api.tabletopsimulator.com/ui/introUI/ -->",
  "ObjectStates": [
    {
      "GUID": "297ebc",
      "Name": "HandTrigger",
      "Transform": {
        "posX": -15.1108065,
        "posY": 4.880399,
        "posZ": -20.1076221,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 11.7720833,
        "scaleY": 9.174497,
        "scaleZ": 4.87123871
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.856,
        "g": 0.09999997,
        "b": 0.09399996,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Red",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "61b6ae",
      "Name": "HandTrigger",
      "Transform": {
        "posX": -30.2150211,
        "posY": 4.880399,
        "posZ": 10.17524,
        "rotX": 0.0,
        "rotY": 90.0,
        "rotZ": 0.0,
        "scaleX": 11.6560965,
        "scaleY": 9.174497,
        "scaleZ": 4.92032671
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.905,
        "g": 0.898,
        "b": 0.171999961,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Yellow",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "392b03",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 30.25128,
        "posY": 4.880399,
        "posZ": 9.59069252,
        "rotX": 0.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 11.65609,
        "scaleY": 9.174497,
        "scaleZ": 4.92032671
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.627,
        "g": 0.124999978,
        "b": 0.941,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Purple",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "f5b4fb",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 15.4749184,
        "posY": 4.880399,
        "posZ": 19.8365288,
        "rotX": 0.0,
        "rotY": 179.8,
        "rotZ": 0.0,
        "scaleX": 11.7727289,
        "scaleY": 9.174497,
        "scaleZ": 4.871627
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.117999978,
        "g": 0.53,
        "b": 1.0,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Blue",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "f5724e",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 15.1961479,
        "posY": 4.880399,
        "posZ": -20.1400986,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 11.772069,
        "scaleY": 9.17449951,
        "scaleZ": 4.87123871
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "White",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "40f9d8",
      "Name": "HandTrigger",
      "Transform": {
        "posX": -15.1927767,
        "posY": 4.880399,
        "posZ": 19.787817,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 11.772069,
        "scaleY": 9.174497,
        "scaleZ": 4.87123871
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.191999972,
        "g": 0.701,
        "b": 0.167999953,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Green",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "2c8885",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 30.10358,
        "posY": 4.880399,
        "posZ": -8.449126,
        "rotX": 0.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 11.6560869,
        "scaleY": 9.174497,
        "scaleZ": 4.92032671
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.96,
        "g": 0.438999981,
        "b": 0.807,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Pink",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "d94a66",
      "Name": "HandTrigger",
      "Transform": {
        "posX": -30.247818,
        "posY": 4.880399,
        "posZ": -8.822588,
        "rotX": 0.0,
        "rotY": 90.0,
        "rotZ": 0.0,
        "scaleX": 11.6561,
        "scaleY": 9.174497,
        "scaleZ": 4.92032671
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.9559999,
        "g": 0.39199996,
        "b": 0.112999953,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Orange",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "920354",
      "Name": "Bag",
      "Transform": {
        "posX": -9.8655E-06,
        "posY": 0.774966955,
        "posZ": -2.7443748E-06,
        "rotX": -2.68638337E-06,
        "rotY": -0.000419576332,
        "rotZ": 4.66917243E-07,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Battlescribe Army Creator",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.7058823,
        "g": 0.366520882,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "Number": 0,
      "Bag": {
        "Order": 0
      },
      "LuaScript": "ACTIVATED_BUTTON = \"rgb(1,0.6,1)|rgb(1,0.4,1)|rgb(1,0.2,1)|rgb(1,0.2,1)\"\nDEFAULT_BUTTON = \"#FFFFFF|#FFFFFF|#C8C8C8|rgba(0.78,0.78,0.78,0.5)\"\nprodServerURL = \"https://battlescribe2tts-backend-ymofho42gq-uc.a.run.app\"\nserverURL = prodServerURL\nversion = \"1.10\"\n\nnextModelTarget = \"\"\nnextModelButton = \"\"\ndescriptorMapping = {}\ncode = \"\"\nrecordCode=\"\"\nrecordTime=os.time()\nrosterMapping = {}\nbuttonMapping = {}\ncreateArmyLock = false\n\nfunction onScriptingButtonDown(index, peekerColor)\n  local player = Player[peekerColor]\n  if index == 1 and player.getHoverObject() and player.getHoverObject().getGUID() == self.getGUID() then\n    broadcastToAll(\"Activating Development Mode\")\n    serverURL = \"http://localhost:8080\"\n  end\n  if index == 2 and player.getHoverObject() and player.getHoverObject().getGUID() == self.getGUID() then\n    broadcastToAll(\"Activating Production Mode\")\n    serverURL = prodServerURL\n  end\nend\n\nfunction tempLock()\n  self.setLock(true)\n  local this = self\n  Wait.time(\n    function()\n      this.setLock(false)\n    end,\n    3\n  )\nend\n\nfunction onLoad(statestr)\n  if statestr ~= nil and #statestr > 0 then\n    local state = JSON.decode(statestr)\n    rosterMapping = state.rosterMapping\n    descriptorMapping = state.descriptorMapping\n    recordCode = state.recordCode\n    recordTime = state.recordTime\n    if recordCode == nil then\n      recordCode = \"\"\n      recordTime = os.time()\n    end\n  end\n  checkVersion()\n  local inputValue=\"\"\n  local xmlString='<Panel width = \"600\" height = \"600\" position = \"500 0 -300\"> <VerticalLayout> <Text fontSize=\"50\" color=\"rgb(1,1,1)\">Battlescribe Army Creator</Text> <InputField  onValueChanged=\"setCode\" placeholder=\"code\" fontSize=\"50\" id=\"code-input\">'..recordCode..'</InputField> <Button onClick=\"submitCode\" fontSize=\"50\">Submit Code</Button> <Button onClick=\"createArmy\" id=\"create-army\" fontSize=\"50\">Create Army</Button>   </VerticalLayout> </Panel>'\n  if isRecordedCodeValid() then\n     inputValue= recordCode\n     code=recordCode\n     printToAll(\"Autosetting recorded code\", \"Teal\")\n  end\n  self.UI.setXml(xmlString)\n  Wait.time(announce, 4)\nend\n\nfunction onSave()\n  return JSON.encode({\n    rosterMapping = rosterMapping,\n    descriptorMapping = descriptorMapping,\n    recordCode = recordCode,\n    recordTime = recordTime,\n  })\nend\n\nfunction announce()\n  broadcastToAll(\"Thanks for using Battlescribe Army Creator! Go to https://battlescribe2tts.net for instructions\")\nend\n\nfunction checkVersion()\n  WebRequest.get(serverURL .. \"/version\", verifyVersion)\nend\n\nfunction verifyVersion(req)\n  if req and req.text then\n    local json = JSON.decode(req.text)\n    if json and json.id then\n      local remoteVersion = json.id\n      if remoteVersion ~= version then\n        Wait.time(\n          function()\n            broadcastToAll(\n              \"You are using an out-of-date version of Battlescribe Army Creator. \" ..\n                \"Get the latest version from the workshop!\"\n            )\n          end,\n          3\n        )\n      end\n    end\n  end\nend\n\nfunction setModel(player, value, id)\n  if #pickedUp > 0 then\n    Wait.stop(timerId)\n    processPickups()\n  end\n  nextModelTarget = self.UI.getValue(id)\n  print(\"Target is \" .. nextModelTarget)\n  local shortName = self.UI.getAttribute(id, \"shortName\")\n  nextModelButton = id\n  broadcastToAll(\"Pick up an object to set it as the model for \" .. shortName)\nend\n\npickedUp = {}\ntimerId = nil\n\nfunction onObjectPickUp(colorName, obj)\n  if nextModelTarget ~= \"\" then\n    obj.highlightOn({1, 0, 1}, 5)\n    self.UI.setAttribute(nextModelButton, \"colors\", ACTIVATED_BUTTON)\n    table.insert(pickedUp, obj.getGUID())\n    if timerId ~= nil then\n      Wait.stop(timerId)\n    end\n    timerId = Wait.frames(function()\n      processPickups()\n    end,0.5)\n  end\nend\n\nfunction processPickups()\n  local modelList = {}\n  print(\"Processing \" .. tostring(#pickedUp) .. \" pickups for \" .. nextModelTarget)\n  for k, objGUID in pairs(pickedUp) do\n    local obj = getObjectFromGUID(objGUID)\n    local bounds = obj.getBoundsNormalized()\n    local width = math.max(bounds.size.x, bounds.size.z) * 1.2\n    local script  = obj.script_code\n    obj.script_code = \"\"\n    local copy = JSON.decode(obj.getJSON())\n    obj.script_code = script\n    copy.Nickname = nextModelTarget\n    copy.States = nil\n    copy.Width = width\n    table.insert(modelList, copy)\n  end\n  print(\"Desc: \" .. JSON.encode(descriptorMapping[nextModelTarget]))\n  local data = {\n    name = nextModelTarget,\n    descriptor = descriptorMapping[nextModelTarget],\n    json = modelList\n  }\n  local jsonData = JSON.encode(data)\n  local this = self\n  local name = nextModelTarget .. \"\"\n\n  descriptorMapping[name] = data.descriptor\n  rosterMapping[name] = data.json\n  if buttonMapping[name] ~= nil then\n    thisContainer.UI.setAttribute(buttonMapping[name], \"colors\", ACTIVATED_BUTTON)\n  end\n  nextModelTarget = \"\"\n  nextModelButton = \"\"\n  pickedUp = {}\n  timerId = nil\nend\n\nfunction filterObjectEnter(obj)\n  return obj.getVar(\"bs2tts-allowed\") == true\nend\n\nfunction doNothing()\nend\n\nfunction setCode(player, value, id)\n    if string.len(value) < 8 then\n      doNothing()\n      --printToAll(\"Skipping code!\", \"Red\")\n      return\n    end\n    code = value\n    --printToAll(\"Setting code: \"..code, \"Yellow\")\n    if code ~= recordCode or os.difftime(os.time(), recordTime) > 3600 then\n          recordCode= code\n          --printToAll(\"Recording code: \"..recordCode, \"Green\")\n          recordTime = os.time()\n          self.script_state=onSave()\n    end\nend\n\nfunction isRecordedCodeValid()\n    --if code ~= recordCode or os.difftime(os.time(), recordTime) > 3600 then\n    if os.difftime(os.time(), recordTime) > 3600 then\n        return false\n    else\n        return true\n    end\nend\n\nfunction getCode()\n  return code\nend\n\nfunction submitCode(player, value, id)\n  if player.host then\n    WebRequest.get(serverURL .. \"/roster/\" .. getCode() .. \"/names\", processNames)\n  else\n    broadcastToAll(\"Sorry, only the host of this game may use the Battlescribe Army Creator\")\n  end\nend\n\nfunction tabToS(tab)\n  local s = \"{\"\n  for k, v in pairs(tab) do\n    s = s .. k .. \"=\" .. tostring(v) .. \",\"\n  end\n  s = s .. \"}\"\n  return s\nend\n\nfunction getList(header, l)\n  local result = \"\"\n  for k, v in pairs(l) do\n    if result ~= \"\" then\n      result = result .. \", \"\n    end\n    result = result .. v\n  end\n  if #result > 0 then\n    result = \"\\n\" .. header .. \": \" .. result\n  end\n  if #result > 128 then\n    result = string.sub(result, 1, 90) .. \"...\"\n  end\n  return result\nend\n\nfunction processNames(webReq)\n  tempLock()\n  if not webReq or webReq.error or webReq.is_error then\n    broadcastToAll(\"Error in web request: No such roster or server error\")\n    return\n  end\n  local response = JSON.decode(webReq.text)\n  local buttonNames = {}\n  local shortNames = {}\n  for k, v in pairs(response.modelsRequested) do\n    local weapons = getList(\"Weapons\",v.modelWeapons)\n    local abilities = getList(\"Abilities\",v.modelAbilities)\n    local upgrades = getList(\"Upgrades\",v.modelUpgrades)\n    local name = \"Model: \" .. v.modelName .. weapons .. upgrades .. abilities\n    table.insert(buttonNames, { name = name, lineHeight = lineHeight})\n    shortNames[name] = v.modelName\n    descriptorMapping[name] = v\n    print(\"Desc for \" .. name .. \" is \" .. JSON.encode(v))\n  end\n  local zOffset = -3\n  local xOffset = 3\n  local vectors = {}\n  local index = 0\n  local newButtons = {}\n  local heightInc = 400\n  local widthInc = 900\n  local colHeight = math.max(5, math.ceil(#buttonNames / 4))\n\n  for k, v in pairs(buttonNames) do\n    local buttonColor = DEFAULT_BUTTON\n    if rosterMapping[v[\"name\"]] ~= nil then\n      buttonColor = ACTIVATED_BUTTON\n    end\n    local buttonId = \"select \" .. v[\"name\"] .. \" \" .. index\n    buttonMapping[v] = buttonId\n    table.insert(\n      newButtons,\n      {\n        tag = \"Button\",\n        attributes = {\n          id = buttonId,\n          onClick = \"setModel\",\n          modelName = v[\"name\"],\n          shortName = shortNames[v[\"name\"]],\n          padding = 20,\n          colors = buttonColor,\n          fontSize = 50,\n          height = heightInc,\n          width = widthInc,\n          offsetXY = (widthInc * (math.floor(index / colHeight))) .. \" \" .. -1 * heightInc * (index % colHeight)\n        },\n        value = v[\"name\"]\n      }\n    )\n    index = index + 1\n  end\n  local xstart = 1300 + (widthInc - 900)\n  local panel = {\n    tag = \"Panel\",\n    attributes = {\n      width = widthInc * ((#buttonNames / colHeight) + 1),\n      height = heightInc * colHeight,\n      position = tostring(xstart) .. \" 0 -500\"\n    },\n    children = newButtons\n  }\n  local currentUI = self.UI.getXmlTable()\n  self.UI.setXmlTable({currentUI[1], panel})\n  self.setVectorLines(vectors)\nend\n\nfunction spawnModelRecur(id, threads, limit, index)\n  if index < limit then\n    WebRequest.get(\n      serverURL .. \"/v2/roster/\" .. id .. \"/\" .. index,\n      function(req)\n        if req and req.text then\n          local v = JSON.decode(req.text)\n          local relPos = v.Transform\n          local thisPos = self.getPosition()\n          local adjustedPos = {\n            x = thisPos.x + relPos.posX - 20,\n            y = thisPos.y + relPos.posY + 4,\n            z = thisPos.z + relPos.posZ\n          }\n          v.Snap = false\n          v.Grid = false\n          v.Hands = false\n          local jv = JSON.encode(v)\n          spawnObjectJSON(\n            {\n              json = jv,\n              position = adjustedPos\n            }\n          )\n          spawnModelRecur(id, threads, limit, index + 1)\n        else\n          broadcastToAll(\"Error requesting model \" .. index)\n        end\n      end\n    )\n  else\n    spawnThreadCounter = spawnThreadCounter + 1\n    if spawnThreadCounter >= threads then\n      broadcastToAll(\"Army creation complete!\")\n    end\n  end\nend\n\nspawnThreadCounter = 0\n\nfunction createArmy(player, value, id)\n  if player.host then\n    if not createArmyLock then\n      spawnThreadCounter = 0\n      tempLock()\n      createArmyLock = true\n      Wait.time(\n        function()\n          createArmyLock = false\n          self.UI.setAttribute(id, \"interactable\", \"true\")\n        end,\n        5\n      )\n      self.UI.setAttribute(id, \"interactable\", \"false\")\n      mappingResponse = {modelAssignments = {}}\n      for name, json in pairs(rosterMapping) do\n        local assignment = {\n          modelJSON = json,\n          descriptor = descriptorMapping[name]\n        }\n        table.insert(mappingResponse.modelAssignments, assignment)\n      end\n      local jsonToSend = JSON.encode(mappingResponse)\n      broadcastToAll(\"Contacting Server (this may take a minute or two)...\")\n      WebRequest.put(\n        serverURL .. \"/v2/roster/\" .. getCode(),\n        jsonToSend,\n        function(req)\n          broadcastToAll(\"Loading Models...\")\n          if not req or req.is_error then\n            broadcastToAll(\"Error in web request\")\n          end\n          local status, result =\n            pcall(\n            function()\n              return JSON.decode(req.text)\n            end\n          )\n          if status then\n            local response = JSON.decode(req.text)\n            local itemsToSpawn = response.itemCount\n            local groupsOf = 10\n            for i = 0, (itemsToSpawn / groupsOf), 1 do\n              local start = i * groupsOf\n              spawnModelRecur(getCode(), (itemsToSpawn / groupsOf), math.min(start + groupsOf, itemsToSpawn), start)\n            end\n          else\n            broadcastToAll(\"Got error: \" .. req.text, {r = 1, g = 0, b = 0})\n          end\n        end\n      )\n    end\n  else\n    broadcastToAll(\"Sorry, only the host of this game may use the Battlescribe Army Creator\")\n  end\nend",
      "LuaScriptState": "{\"descriptorMapping\":[],\"recordCode\":\"\",\"recordTime\":1589056077.03936,\"rosterMapping\":[]}",
      "XmlUI": "<Panel width = \"600\" height = \"600\" position = \"500 0 -300\">\n  <VerticalLayout>\n    <Text fontSize=\"50\" color=\"rgb(1,1,1)\">Battlescribe Army Creator</Text>\n    <InputField onValueChanged=\"setCode\" placeholder=\"code\" fontSize=\"50\" id=\"code-input\"></InputField>\n    <Button onClick=\"submitCode\" fontSize=\"50\">Submit Code</Button>\n    <Button onClick=\"createArmy\" id=\"create-army\" fontSize=\"50\">Create Army</Button>\n  </VerticalLayout>\n</Panel>\n\n"
    },
    {
      "GUID": "14bc6e",
      "Name": "reversi_chip",
      "Transform": {
        "posX": -4.947882,
        "posY": 1.0958432,
        "posZ": -5.62408543,
        "rotX": 3.402468E-07,
        "rotY": 5.255891E-06,
        "rotZ": -4.72084281E-07,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "BS2TTS Control Panel",
      "Description": "",
      "GMNotes": "",
      "ColorDiffuse": {
        "r": 0.757352948,
        "g": 0.757352948,
        "b": 0.757352948
      },
      "LayoutGroupSortIndex": 0,
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "\nui = [[\n  <Panel color=\"#FFFFFF\" height=\"1000\" width=\"450\" position = \"0 500 -100\">\n    <VerticalLayout> \n      <Text fontSize=\"50\" color=\"rgb(0,0,0)\">BS2TTS Control Panel</Text>\n      <Button height=\"160\" color=\"rgb(1,1,1)\" onClick=\"theguid/openDataSheet\"><Text fontSize=\"50\" width=\"600\" color=\"rgb(0,0,0)\" >Open Datasheet</Text></Button>\n      <Text fontSize=\"45\" color=\"rgb(0,0,0)\">Wounds</Text>\n      <HorizontalLayout>\n        <Button color=\"rgb(1,1,1)\" onClick=\"theguid/decreaseWounds\"><Text fontSize=\"70\" color=\"rgb(0,0,0)\" >-</Text></Button>\n        <Button color=\"rgb(1,1,1)\" onClick=\"theguid/increaseWounds\"><Text fontSize=\"70\" color=\"rgb(0,0,0)\" >+</Text></Button>\n      </HorizontalLayout>\n      <Text fontSize=\"45\" color=\"rgb(0,0,0)\">Range Finder</Text>\n      <HorizontalLayout>\n        <Button color=\"rgb(1,1,1)\" onClick=\"theguid/decreaseRadius\"><Text fontSize=\"70\" color=\"rgb(0,0,0)\" >-</Text></Button>\n        <Button color=\"rgb(1,1,1)\" onClick=\"theguid/increaseRadius\"><Text fontSize=\"70\" color=\"rgb(0,0,0)\" >+</Text></Button>\n      </HorizontalLayout>\n      <Text fontSize=\"45\" color=\"rgb(0,0,0)\">Base Size</Text>\n      <HorizontalLayout>\n        <Button color=\"rgb(1,1,1)\" onClick=\"theguid/decrBase\"><Text fontSize=\"70\" color=\"rgb(0,0,0)\" >-</Text></Button>\n        <Button color=\"rgb(1,1,1)\" onClick=\"theguid/incrBase\"><Text fontSize=\"70\" color=\"rgb(0,0,0)\" >+</Text></Button>\n      </HorizontalLayout>\n    </VerticalLayout> \n  </Panel>\n]]\n\nfunction onLoad()\n  local completeUi = string.gsub(ui, \"theguid\", self.getGUID())\n  self.UI.setXml(completeUi)\nend\n\n\nfunction openDataSheet(player, val, id)\n  activateScriptingButton(player, 1)\nend\n\nfunction decreaseWounds(player, val, id)\n  activateScriptingButton(player, 2)\nend\n\nfunction increaseWounds(player, val, id)\n  activateScriptingButton(player, 3)\nend\n\nfunction increaseRadius(player, val, id)\n  activateScriptingButton(player, 4)\nend\n\nfunction decreaseRadius(player, val, id)\n  activateScriptingButton(player, 5)\nend\n\nfunction incrBase(player, val, id)\n  activateScriptingButton(player, 6)\nend\n\nfunction decrBase(player, val, id)\n  activateScriptingButton(player, 7)\nend\n\n\nfunction activateScriptingButton(player, index)\n  local peekerColor = player.color\n  local selected = player.getSelectedObjects()\n  if #selected > 0 then\n    for k, obj in pairs(getAllObjects()) do\n      if obj.getVar(\"isMaster\") then\n        obj.call(\"onScriptingButtonDownTable\", {index = index, peekerColor = peekerColor})\n      end\n    end\n  end\nend",
      "LuaScriptState": "",
      "XmlUI": ""
    }
  ]
}